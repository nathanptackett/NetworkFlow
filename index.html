<!DOCTYPE html>
<html>
   <head>
      <title>Main</title>
      <script  src="https://threejs.org/build/three.js"></script>
      <script src="https://threejs.org/examples/js/renderers/CanvasRenderer.js"></script>
      <script  src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

      <script id="vertexShader" type="x-shader/x-vertex">
         precision highp float;

         attribute vec3 position;
         attribute vec3 normal;

         varying vec3 vNormal;
         varying vec4 vPosition;

         uniform mat4 modelViewMatrix;
         uniform mat4 projectionMatrix;
         uniform mat3 normalMatrix;
         uniform mat4 modelMatrix;
         uniform mat4 viewMatrix;

         void main()	{
            vNormal = normalize(normalMatrix*normal);
            vPosition = vec4(position, 1.0)*modelMatrix;

            gl_Position = projectionMatrix*modelViewMatrix*vec4(position, 1.0 );
         }
      </script>

      <script id="fragmentShader" type="x-shader/x-fragment">
         precision highp float;

         varying vec4 vPosition;
         varying vec3 vNormal;

         uniform int radius;
         uniform vec2 mousePos;
         uniform vec2 resolution;

         void main()   {
            gl_FragColor = vec4(vNormal, 1.0);
         }
      </script>

      <script>
         // Add your own Javascript code/methods here.
         var scene;
         var camera;
         var sphere;

         function mainFunction()
         {
            let renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setSize( window.innerWidth*.8, window.innerHeight*.8 );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setClearColor (0xD3D3D3, 1);
            document.body.appendChild( renderer.domElement );

            scene = new THREE.Scene();
            let aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera( 30, aspect, 1, 1000 );
            camera.position.z = 15;
            scene.add(camera);
            let cameraControls = new THREE.OrbitControls(camera, renderer.domElement);
            
            let light = new THREE.AmbientLight( 0xFFFFFF );
            scene.add( light );
            
            //Handle Resize of window
            let resize = function () {
               renderer.setSize(window.innerWidth*.8, window.innerHeight*.8);
               camera.aspect = window.innerWidth / window.innerHeight;
               camera.updateProjectionMatrix();
            };

            window.addEventListener("resize",resize, false);

            //render function
            let render = function () {
               requestAnimationFrame( render );
               renderer.render( scene, camera );
            };

            render();
         }

         function getViewSpaceShader()
         {
            /*
            return new THREE.RawShaderMaterial({
               vertexShader: document.getElementById('vertexShader').textContent,
               fragmentShader: document.getElementById('fragmentShader').textContent,
            }); */
            return new THREE.MeshNormalMaterial();
         }

         function addPipe(node1, node2)
         {
            let deltaX = node1.position.x - node2.position.x;
            let deltaY = node1.position.y - node2.position.y;
            let deltaZ = node1.position.z - node2.position.z;

            let length = Math.sqrt(deltaX*deltaX + deltaY*deltaY + deltaZ*deltaZ);
            let pipeGeometry = new THREE.CylinderGeometry(0.5, 0.5, length);
            let  pipeMaterial = getViewSpaceShader();
            let pipe = new THREE.Mesh(pipeGeometry, pipeMaterial);

            pipe.position.set((node1.position.x + node2.position.x) / 2, (node1.position.y + node2.position.y) / 2, (node1.position.z + node2.position.z) / 2);
            pipe.lookAt(node1.position);
            pipe.rotateOnAxis(new THREE.Vector3(1, 0, 0), Math.PI/2);
            scene.add(pipe);
            return pipe;
         }

         function addNode(x, y, z)
         {
            let nodeGeometry = new THREE.SphereGeometry(2);
            let nodeMaterial = getViewSpaceShader();
            let node = new THREE.Mesh(nodeGeometry, nodeMaterial);


            node.position.set(x, y, z);

            scene.add(node);
            return node;
         }
      </script>
   </head>
   
   <body onload="mainFunction();">
         <h1>--Nathan Tackett 4421778--</h1>
   </body>
   
</html>
